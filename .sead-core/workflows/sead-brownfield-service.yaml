# SEAD Brownfield Service Enhancement Workflow
workflow:
  id: sead-brownfield-service
  name: SEAD Constitutional Brownfield Service/API Enhancement
  description: >-
    Constitutional agent workflow for enhancing existing backend services and APIs with new features,
    modernization, or performance improvements. Handles existing system analysis with catalog integration,
    governance validation, and safe constitutional integration with context preservation.
  type: constitutional_brownfield_service
  constitutional_framework: true
  catalog_integration: true
  governance_validation: enabled
  context_preservation: enforced
  project_types:
    - constitutional-service-modernization
    - constitutional-api-enhancement
    - constitutional-microservice-extraction
    - constitutional-performance-optimization
    - constitutional-integration-enhancement
    - catalog-api-pattern-evolution
    - governance-service-compliance

  constitutional_requirements:
    mode_detection: required
    catalog_read: mandatory
    governance_validation: continuous
    context_preservation: enforced
    agent_handoff_validation: required

  sequence:
    - step: constitutional_service_analysis
      agent: sead-architect
      action: analyze existing project with constitutional compliance and use sead-document-project
      creates: multiple constitutional documents per the sead-document-project template
      constitutional_validation: required
      catalog_integration: required
      notes: |
        Review existing constitutional service documentation with catalog integration:
        - API contracts catalog pattern analysis and governance compliance assessment
        - Service architecture with constitutional validation requirements
        - Performance metrics with governance monitoring integration
        - Integration dependencies with catalog pattern identification
        - Context preservation requirements for service interactions

    - agent: sead-product-owner
      creates: sead-prd.md
      uses: sead-brownfield-prd-tmpl
      requires: constitutional_existing_service_analysis
      constitutional_validation: required
      catalog_integration: required
      notes: |
        Creates comprehensive constitutional PRD focused on service enhancement with:
        - Existing constitutional system analysis with governance validation
        - API contracts catalog integration and evolution strategy
        - Service governance compliance requirements and validation framework
        - Context preservation strategy for service interactions and agent handoffs
        CONSTITUTIONAL SAVE OUTPUT: Copy final sead-prd.md to your project's docs/ folder with catalog integration references.

    - agent: sead-architect
      creates: sead-architecture.md
      uses: sead-brownfield-architecture-tmpl
      requires: sead-prd.md
      constitutional_validation: required
      catalog_integration: required
      notes: |
        Creates constitutional architecture with comprehensive catalog integration:
        - Service integration strategy with governance validation framework
        - API evolution planning with api-contracts catalog compliance
        - Constitutional service patterns and catalog evolution contribution
        - Context preservation architecture for service interactions and agent handoffs
        - Integration patterns catalog compliance and governance validation
        CONSTITUTIONAL SAVE OUTPUT: Copy final sead-architecture.md to your project's docs/ folder with catalog pattern references.

    - agent: sead-product-owner
      validates: all_constitutional_artifacts
      uses: sead-po-master-checklist
      constitutional_validation: required
      catalog_integration: required
      notes: |
        Validates all constitutional documents for service integration safety with governance compliance:
        - API compatibility with catalog contracts validation
        - Service governance compliance verification
        - Constitutional integration safety with catalog pattern compliance
        - Context preservation validation for service interactions
        May require updates to any constitutional document with catalog integration improvements.

    - agent: various_constitutional_agents
      updates: any_flagged_constitutional_documents
      condition: constitutional_po_checklist_issues
      constitutional_validation: required
      catalog_integration: required
      notes: |
        If Constitutional PO finds issues, return to relevant constitutional agent to fix and re-export 
        updated constitutional documents to docs/ folder with:
        - Governance validation compliance
        - Catalog integration improvements
        - Context preservation enhancements

    - agent: sead-product-owner
      action: shard_constitutional_documents
      creates: sharded_constitutional_docs
      requires: all_constitutional_artifacts_in_project
      constitutional_validation: required
      catalog_integration: required
      notes: |
        Shard constitutional documents for IDE development with catalog integration:
        - Option A: Use Constitutional PO agent to shard: @sead-product-owner then ask to shard docs/sead-prd.md
        - Option B: Manual: Drag sead-shard-doc task + docs/sead-prd.md into chat
        - Creates docs/sead-prd/ and docs/sead-architecture/ folders with sharded constitutional content
        - All shards include api-contracts catalog references and governance validation requirements
        - Context preservation documentation included in all shards

    - agent: sead-scrum-master
      action: create_constitutional_story
      creates: sead-story.md
      requires: sharded_constitutional_docs
      repeats: for_each_constitutional_epic
      constitutional_validation: required
      catalog_integration: required
      notes: |
        Constitutional story creation cycle with governance validation:
        - Constitutional SM Agent (New Chat): @sead-scrum-master → *create
        - Creates next constitutional story from sharded docs with catalog integration
        - Constitutional story starts in "Draft" status with governance validation pending
        - All stories include api-contracts catalog compliance requirements
        - Context preservation requirements documented for service interactions

    - agent: sead-analyst/sead-project-manager
      action: review_draft_constitutional_story
      updates: sead-story.md
      requires: sead-story.md
      optional: true
      condition: user_wants_constitutional_story_review
      constitutional_validation: required
      catalog_integration: required
      notes: |
        OPTIONAL: Review and approve draft constitutional story with governance validation:
        - NOTE: sead-story-review task with api-contracts catalog compliance verification
        - Review constitutional story completeness, catalog compliance, and governance alignment
        - Update constitutional story status: Draft → Approved with governance validation
        - Validate service integration safety and context preservation requirements

    - agent: sead-developer
      action: implement_constitutional_story
      creates: constitutional_implementation_files
      requires: sead-story.md
      constitutional_validation: required
      catalog_integration: required
      notes: |
        Constitutional Dev Agent (New Chat): @sead-developer with service governance validation
        - Implements approved constitutional story with api-contracts catalog compliance
        - Updates File List with all constitutional changes and service integration references
        - Ensures governance validation throughout service implementation
        - Maintains context preservation for service interactions and agent handoffs
        - Marks constitutional story as "Review" when complete with governance compliance

    - agent: sead-qa
      action: review_constitutional_implementation
      updates: constitutional_implementation_files
      requires: constitutional_implementation_files
      optional: true
      constitutional_validation: required
      catalog_integration: required
      notes: |
        OPTIONAL: Constitutional QA Agent (New Chat): @sead-qa → sead-review-story with service governance validation
        - Senior constitutional dev review with catalog-compliant service refactoring ability
        - Fixes small constitutional service issues directly with governance validation
        - Leaves constitutional checklist for remaining service items with api-contracts catalog compliance requirements
        - Updates constitutional story status (Review → Done or stays Review) with governance validation
        - Validates service integration safety and context preservation

    - agent: sead-developer
      action: address_constitutional_qa_feedback
      updates: constitutional_implementation_files
      condition: constitutional_qa_left_unchecked_items
      constitutional_validation: required
      catalog_integration: required
      notes: |
        If Constitutional QA left unchecked service items with governance implications:
        - Constitutional Dev Agent (New Chat): Address remaining constitutional service items with api-contracts catalog compliance
        - Return to Constitutional QA for final service governance validation approval
        - Ensure service integration safety and context preservation throughout feedback resolution

    - step: repeat_constitutional_development_cycle
      action: continue_for_all_constitutional_stories
      constitutional_validation: required
      catalog_integration: required
      notes: |
        Repeat constitutional story cycle (Constitutional SM → Constitutional Dev → Constitutional QA) for all constitutional service epic stories
        Continue until all constitutional stories in PRD are complete with:
        - Service governance validation and api-contracts catalog compliance
        - Context preservation across all service interactions and agent handoffs
        - Integration patterns catalog evolution and governance compliance

    - agent: sead-product-owner
      action: constitutional_epic_retrospective
      creates: sead-epic-retrospective.md
      condition: constitutional_epic_complete
      optional: true
      constitutional_validation: required
      catalog_integration: required
      notes: |
        OPTIONAL: After constitutional service epic completion with governance validation
        - NOTE: sead-epic-retrospective task with api-contracts catalog evolution assessment
        - Validate constitutional service epic was completed correctly with governance compliance
        - Document constitutional service learnings, catalog evolution contributions, and governance improvements
        - Assess service integration safety and context preservation effectiveness across agent handoffs

    - step: constitutional_workflow_end
      action: constitutional_project_complete
      constitutional_validation: required
      catalog_integration: required
      notes: |
        All constitutional service stories implemented and reviewed with governance validation!
        Constitutional service project development phase complete with:
        - API contracts catalog integration and evolution
        - Service governance compliance and validation
        - Context preservation across service interactions

        Constitutional Reference: .sead-core/data/sead-kb.md#Constitutional Service Development Workflow

  constitutional_flow_diagram: |
    ```mermaid
    graph TD
        A[Start: Constitutional Service Enhancement] --> B[sead-analyst: analyze constitutional existing service]
        B --> C[sead-po: constitutional prd.md]
        C --> D[sead-architect: constitutional architecture.md]
        D --> E[sead-po: validate with sead-po-master-checklist]
        E --> F{Constitutional PO finds issues?}
        F -->|Yes| G[Return to constitutional agent for fixes]
        F -->|No| H[sead-po: shard constitutional documents]
        G --> E
        
        H --> I[sead-sm: create constitutional story]
        I --> J{Review constitutional draft story?}
        J -->|Yes| K[sead-analyst/sead-pm: review & approve constitutional story]
        J -->|No| L[sead-dev: implement constitutional story]
        K --> L
        L --> M{Constitutional QA review?}
        M -->|Yes| N[sead-qa: review constitutional implementation]
        M -->|No| O{More constitutional stories?}
        N --> P{Constitutional QA found issues?}
        P -->|Yes| Q[sead-dev: address constitutional QA feedback]
        P -->|No| O
        Q --> N
        O -->|Yes| I
        O -->|No| R{Constitutional Epic retrospective?}
        R -->|Yes| S[sead-po: constitutional epic retrospective]
        R -->|No| T[Constitutional Project Complete]
        S --> T

        style T fill:#90EE90
        style H fill:#ADD8E6
        style I fill:#ADD8E6
        style L fill:#ADD8E6
        style C fill:#FFE4B5
        style D fill:#FFE4B5
        style K fill:#F0E68C
        style N fill:#F0E68C
        style S fill:#F0E68C
    ```

  constitutional_decision_guidance:
    when_to_use:
      - Constitutional service enhancement requires coordinated governance-validated stories
      - Constitutional API versioning or breaking changes with catalog compliance needed
      - Constitutional database schema changes with governance validation required
      - Constitutional performance or scalability improvements with governance monitoring needed
      - Multiple constitutional integration points with catalog patterns affected
      - API contracts catalog evolution with governance compliance required

  constitutional_handoff_prompts:
    constitutional_analyst_to_pm: |
      Constitutional service analysis complete with governance validation and catalog integration. 
      Key findings include:
      - API contracts catalog pattern analysis: {{api_catalog_analysis}}
      - Service governance compliance assessment: {{governance_compliance_assessment}}
      - Context preservation requirements: {{context_preservation_requirements}}
      
      Create comprehensive constitutional PRD with service integration strategy, governance validation, and catalog compliance.

    constitutional_pm_to_architect: |
      Constitutional PRD ready with governance validation and api-contracts catalog integration. 
      Save it as docs/sead-prd.md with catalog pattern references, then create the constitutional service architecture with:
      - Governance validation framework
      - API contracts catalog compliance
      - Context preservation strategy

    constitutional_architect_to_po: |
      Constitutional architecture complete with comprehensive catalog integration and governance validation. 
      Save it as docs/sead-architecture.md with api-contracts catalog pattern references. 
      Please validate all constitutional artifacts for:
      - Service integration safety with governance compliance
      - API contracts catalog compliance
      - Context preservation validation

    constitutional_po_issues: |
      Constitutional PO found issues with [constitutional_document] affecting governance validation and catalog compliance. 
      Please return to [constitutional_agent] to fix and re-save the updated constitutional document with:
      - Governance validation improvements
      - Catalog integration enhancements
      - Context preservation corrections

    constitutional_complete: |
      All constitutional planning artifacts validated and saved in docs/ folder with governance compliance and catalog integration. 
      Constitutional service artifacts include:
      - API contracts catalog compliance validation
      - Service governance validation framework
      - Context preservation documentation
      
      Move to IDE environment to begin constitutional development with catalog-aware service implementation.